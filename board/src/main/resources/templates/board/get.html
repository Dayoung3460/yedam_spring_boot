<!DOCTYPE html>

<html lang="en" xmlns:layout="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Board</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script th:inline="javascript">
        const bno = [[${board.bno}]]
        window.addEventListener("DOMContentLoaded", () => {
            let replies = document.querySelector(".replies")
            getReply(replies)
            deleteReply(replies)
        })

        function getReply(replies) {
            const url = `/replies/pages/${bno}/1`
            fetch(url).
            then(result => result.json()).
            then(result => addReplyEle(result, replies))
        }


        function addReplyEle(result, replies) {

            result.list.forEach((reply) => {
                const html = `
                    <div class="row">
                        <p>댓글번호: ${reply.rno} | 내용: ${reply.reply} | 댓글쓴사람: ${reply.replyer} | 날짜: ${reply.updatedate}<p>
                        <button class="btn btn-danger delete-btn" data-rno="${reply.rno}">삭제</button>
                    </div>`
                replies.insertAdjacentHTML('beforeend', html)
            })
        }

        function deleteReply(replies) {
            replies.addEventListener('click', (e) => {
                if(e.target.classList.contains("delete-btn")) {
                    const rno = e.target.dataset.rno
                    const url = `/replies/${rno}`
                    fetch(url, {
                        method: 'delete',
                    })
                        .then(result => result.text())
                        .then(result => {
                            replies.replaceChildren()
                            getReply(replies)
                        })
                }
            })
        }
    </script>
</head>
<body>
<div class="container my-5" layout:fragment="content">
    <h2 class="text-center mb-4">Board</h2>

    <!-- Form Start -->
<!--    board: 컨트롤러의 Model에서 던져주는 값 -->
    <form th:object="${board}">
        <div class="mb-3">
            <label for="bno" class="form-label">No.</label>
            <input type="text" th:field="*{bno}" readonly class="form-control" id="bno" placeholder="Enter title" required>
        </div>
        <div class="mb-3">
            <label for="title" class="form-label">Title</label>
            <input type="text" th:field="*{title}" readonly class="form-control" id="title" placeholder="Enter title" required>
        </div>

        <div class="mb-3">
            <label for="content" class="form-label">Content</label>
            <textarea th:field="*{content}" readonly class="form-control" id="content" rows="4" placeholder="Enter content" required></textarea>
        </div>

        <div class="mb-3">
            <label for="writer" class="form-label">Writer</label>
            <input type="text" th:field="*{writer}" readonly class="form-control" id="writer" placeholder="Enter writer's name" required>
        </div>
    </form>
    <!-- Form End -->

    <hr/>
    <h3 class="text-center my-4">Comment</h3>
    <div class="card">
        <div class="card-body replies">
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
</body>
</html>